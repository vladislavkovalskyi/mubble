<img src="../../images/mubble_logo.png" alt="Mubble logo" width="50%" height="50%">

# Middleware (Ukrainian üá∫üá¶)
–¶–µ–π –ø—Ä–∏–∫–ª–∞–¥ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è —Ç–æ–≥–æ, —â–æ–± –ø–æ–∫–∞–∑–∞—Ç–∏ —è–∫ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ **Middlewares** –≤ **Mubble**

**–î–ª—è —á–æ–≥–æ Middlewares –ø–æ—Ç—Ä—ñ–±–Ω—ñ?**<br>
–í–æ–Ω–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø–æ—Ç—Ä—ñ–±–Ω—ñ, –∫–æ–ª–∏ –≤–∞–º –∑–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —è–∫—ñ—Å—å –∞–ª–≥–æ—Ä–∏—Ç–º–∏ **–î–æ** _(pre)_, –∞–±–æ **–ü—ñ—Å–ª—è** _(post)_ –≤–∞—à–∏—Ö —Ö–µ–Ω–¥–ª–µ—Ä—ñ–≤.<br>
–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –í–∏ —Ö–æ—á–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é –Ω–µ –ø—Ä–æ—Å—Ç–æ, –∫–æ–ª–∏ –ª—é–¥–∏–Ω–∞ –ø–∏—à–µ –∫–æ–º–∞–Ω–¥—É `/start`, –∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é, –∫–æ–ª–∏ –ª—é–¥–∏–Ω–∞ –≤–∂–µ –∫–æ—Ä–∏—Å—Ç—É—î—Ç—å—Å—è –±–æ—Ç–æ–º —ñ –ø–∏—à–µ –±—É–¥—å-—è–∫–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. –¢–∞–∫–æ–∂ –≤—ñ–Ω –º–æ–∂–µ –≤—ñ–¥—Ä–∞–∑—É, –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–Ω—Ç–µ–∫—Å—Ç—É, –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤ —Ö–µ–Ω–¥–ª–µ—Ä —è–∫—É—Å—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ –æ–±'—î–∫—Ç —Å–∞–º–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞), —â–æ–± –≤ —Ä—ñ–∑–Ω–∏—Ö —Ö–µ–Ω–¥–ª–µ—Ä–∞—Ö –Ω–µ —Ä–æ–±–∏—Ç–∏ `CTRL+C/V` –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –π–æ–≥–æ `Telegram ID`.


* –ú–∏ —Å—Ç–≤–æ—Ä—é—î–º–æ –∫–ª–∞—Å `Middleware`, —è–∫–∏–π —É—Å–ø–∞–¥–∫–æ–≤—É—î—Ç—å—Å—è –≤—ñ–¥ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–≥–æ `ABCMiddleware`.<br>
–í –Ω–∞—à–æ–º—É –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–º—É `ABCMiddleware` —î —Ñ—É–Ω–∫—Ü—ñ—ó `pre` —Ç–∞ `post`, —è–∫—ñ –º–∏ –º–æ–∂–µ–º–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏.<br>
–§—É–Ω–∫—Ü—ñ—è `pre` –±—É–¥–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –ø–µ—Ä–µ–¥ —Ç–∏–º, —è–∫ —Å–ø—Ä–∞—Ü—é—î —Ö–µ–Ω–¥–ª–µ—Ä, –∞ —Ñ—É–Ω–∫—Ü—ñ—è `post` —Å–ø—Ä–∞—Ü—é—î —Ç–æ–¥—ñ, –∫–æ–ª–∏ —Ö–µ–Ω–¥–ª–µ—Ä –≤–∂–µ —Å–ø—Ä–∞—Ü—é–≤–∞–≤.<br>
–ö–æ—Ä–æ—Ç–∫–æ: –Ø–∫—â–æ —Ñ—É–Ω–∫—Ü—ñ—è `pre` _(—è–∫ –≤ –Ω–∞—à–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ)_ –ø–æ–≤–µ—Ä—Ç–∞—î False, —Ç–æ —Ä–æ–±–æ—Ç–∞ —Ö–µ–Ω–¥–ª–µ—Ä–∞ –±–ª–æ–∫—É—î—Ç—å—Å—è. –Ø–∫—â–æ –≤–æ–Ω–∞ –ø–æ–≤–µ—Ä—Ç–∞—î True, —Ç–æ —Ö–µ–Ω–¥–ª–µ—Ä –ø—Ä–æ–¥–æ–≤–∂—É—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏.<br>
`ctx.set("generated_number", number)` - —Ç—É—Ç –º–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∫–ª—é—á `generated_number` _(–π–æ–≥–æ –º–∏ –ø–æ—Ç—ñ–º –±—É–¥–µ–º–æ —á–µ–∫–∞—Ç–∏ –≤ —Ö–µ–Ω–¥–ª–µ—Ä—ñ)_, –∞ –π–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è–º `number`.

* –î–∞–ª—ñ –º–∏ –≤–∏–∫–ª–∏–∫–∞—î–º–æ –Ω–∞—à –∑–≤–∏—á–∞–π–Ω–∏–π –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä, —è–∫–∏–π —Ä–µ–∞–≥—É—î –Ω–∞ `/number`, –∞–ª–µ –æ—Å–æ–±–ª–∏–≤—ñ—Å—Ç—å –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ –Ω–∞—à–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è —è–∫—Ä–∞–∑ –ø—Ä–∏–π–º–∞—î –Ω–∞—à –∫–ª—é—á `generated_number` –∑ —Ö–µ–Ω–¥–ª–µ—Ä–∞.<br>

#### ‚ö†Ô∏è –ë—É–¥—å—Ç–µ —É–≤–∞–∂–Ω—ñ. –Ø–∫—â–æ –≤–∏ –±—É–¥–µ—Ç–µ –±—Ä–∞—Ç–∏ —Ü–µ–π –∫–æ–¥ –∑–∞ –æ—Å–Ω–æ–≤–Ω–∏–π, —Ç–æ –ø–∞–º'—è—Ç–∞–π—Ç–µ, —â–æ –Ω–∞—à `Middleware` –±–ª–æ–∫—É—î —Ä–æ–±–æ—Ç—É –±—É–¥—å-—è–∫–∏—Ö —Ö–µ–Ω–¥–ª–µ—Ä—ñ–≤, —Ç–∞–∫ —è–∫ —Ä–∞–Ω–¥–æ–º –º–æ–∂–µ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ —á–∏—Å–ª–æ `1` !!!

## –ü—Ä–∏–∫–ª–∞–¥ –∫–æ–¥—É
–í —Ü—å–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ **Middleware** –≥–µ–Ω–µ—Ä—É—î —Ä–∞–Ω–¥–æ–º–Ω–µ —á–∏—Å–ª–æ –≤—ñ–¥ 1 –¥–æ 3. –Ø–∫—â–æ —á–∏—Å–ª–æ 1, —Ç–æ
–≤—ñ–Ω –±–ª–æ–∫—É—î —Ä–æ–±–æ—Ç—É —Ö–µ–Ω–¥–ª–µ—Ä—ñ–≤, –∞–ª–µ —è–∫—â–æ —á–∏—Å–ª–æ 2 –∞–±–æ 3, —Ç–æ –≤—ñ–Ω —Å–ø–æ–∫—ñ–π–Ω–æ –¥–æ–¥–∞—î —ó—Ö –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ç–∞ –Ω–∞—à —Ö–µ–Ω–¥–ª–µ—Ä —ó—Ö –ª–æ–≤–∏—Ç—å.
```python
import random

from mubble import Token, API, Mubble, ABCMiddleware, Message
from mubble.bot import Context
from mubble.rules import Text

api = API(Token.from_env())
bot = Mubble(api)


class Middleware(ABCMiddleware[Message]):
    async def pre(self, event: Message, ctx: Context) -> bool:
        number = random.randint(1, 3)
        if number == 1:
            await event.answer(
                "üñ• Hello! I'm middleware!\n"
                f"Generated number is {number}\n"
                "Unfortunately I blocked your handler because it turned out to be number 1."
            )
            return False
        
        await event.answer(
            "üñ• Hello! I'm middleware!\n"
            f"Generated number is {number}\n"
            "Now this context will be available to you in a handler."
        )
        ctx.set("generated_number", number)
        return True
        


@bot.on.message(Text("/number"))
async def number(m: Message, generated_number: int):
    await m.reply(f"üôÑ Your number from middleware is {generated_number}")


bot.on.message.middlewares.append(Middleware())
bot.run_forever()

```

## –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
<img src="../../images/middleware.jpg" alt="Mubble logo" width="50%" height="50%">
